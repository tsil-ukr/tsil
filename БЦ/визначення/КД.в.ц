/* КД 0.6.0 */

секція КД {
  структура Система;

  структура Система {
    дані: невідома_адреса;
    виділити_сиру_памʼять: (система: адреса<Система>, розмір: позитивне) -> памʼять<п8>;
    перевиділити_сиру_памʼять: (система: адреса<Система>, значення: памʼять<п8>, новий_розмір: позитивне) -> памʼять<п8>;
    звільнити_сиру_памʼять: (система: адреса<Система>, значення: невідома_памʼять) -> ніщо;
  }

  дія виділити<Т>(система: адреса<Система>) -> адреса<Т>;
  дія перевиділити<Т>(система: адреса<Система>, значення: адреса<Т>, кількість: позитивне) -> памʼять<Т>;
  дія звільнити(система: адреса<Система>, значення: невідома_адреса);
  дія виділити_памʼять<Т>(система: адреса<Система>, кількість: позитивне) -> памʼять<Т>;
  дія перевиділити_памʼять<Т>(система: адреса<Система>, значення: памʼять<Т>, кількість: позитивне) -> памʼять<Т>;
  дія звільнити_памʼять(система: адреса<Система>, значення: невідома_памʼять);

  дія виділити<Т>(система: адреса<Система>) -> адреса<Т> {
    вернути система.виділити_сиру_памʼять(система, Т.розмір) як адреса<Т>;
  }

  дія перевиділити<Т>(система: адреса<Система>, значення: адреса<Т>, кількість: позитивне) -> памʼять<Т> {
    вернути система.перевиділити_сиру_памʼять(система, значення як невідома_адреса, кількість * Т.розмір) як памʼять<Т>;
  }

  дія звільнити(система: адреса<Система>, значення: невідома_адреса) {
    система.звільнити_сиру_памʼять(система, значення як невідома_памʼять);
  }

  дія виділити_памʼять<Т>(система: адреса<Система>, кількість: позитивне) -> памʼять<Т> {
    вернути система.виділити_сиру_памʼять(система, кількість * Т.розмір) як памʼять<Т>;
  }

  дія перевиділити_памʼять<Т>(система: адреса<Система>, значення: памʼять<Т>, кількість: позитивне) -> памʼять<Т> {
    вернути система.перевиділити_сиру_памʼять(система, значення як памʼять<п8>, кількість * Т.розмір) як памʼять<Т>;
  }

  дія звільнити_памʼять(система: адреса<Система>, значення: невідома_памʼять) {
    система.звільнити_сиру_памʼять(система, значення);
  }
}

секція КД {
  секція символи {
    стала Кінець = 0;
    стала Дія = 1;
    стала Початок = 2;
    стала Міжряд = 3;
    стала Міжслово = 4;
    стала Хвиляста = 5;
    стала І = 6;
    стала Відсоток = 7;
    стала Секція = 8;
    стала Мітка = 9;
    стала Адреса = 10;
    стала Хрестик_в_кругу = 11;
    стала Хрестик = 12;
    стала Гривня = 13;
    стала Нескінченність = 14;
    стала Зірочка = 15;
    стала Нуль = 16;
    стала Один = 17;
    стала Два = 18;
    стала Три = 19;
    стала Чотири = 20;
    стала Пʼять = 21;
    стала Шість = 22;
    стала Сім = 23;
    стала Вісім = 24;
    стала Девʼять = 25;
    стала Відкрита_фігурна_дужка = 26;
    стала Закрита_фігурна_дужка = 27;
    стала Відкрита_квадратна_дужка = 28;
    стала Закрита_квадратна_дужка = 29;
    стала Відкрита_дужка = 30;
    стала Закрита_дужка = 31;
    стала Менше = 32;
    стала Більше = 33;
    стала Вище = 34;
    стала Нижче = 35;
    стала Твердий = 36;
    стала Лапка = 37;
    стала Дволапка = 38;
    стала Косолапка = 39;
    стала Міжкрапка = 40;
    стала Двокрапка = 41;
    стала Кома = 42;
    стала Крапкакома = 43;
    стала Питання = 44;
    стала Оклик = 45;
    стала Крапка = 46;
    стала Похила = 47;
    стала Обернена_похила = 48;
    стала Стояча = 49;
    стала Риска = 50;
    стала Гачок = 51;
    стала Підриска = 52;
    стала Двориска = 53;
    стала Велика_буква_Ё = 54;
    стала Велика_буква_Ъ = 55;
    стала Велика_буква_Ы = 56;
    стала Велика_буква_Э = 57;
    стала Мала_буква_ё = 58;
    стала Мала_буква_ъ = 59;
    стала Мала_буква_ы = 60;
    стала Мала_буква_э = 61;
    стала Велика_буква_Ґ = 62;
    стала Мала_буква_ґ = 63;
    стала Велика_буква_А = 64;
    стала Велика_буква_Б = 65;
    стала Велика_буква_В = 66;
    стала Велика_буква_Г = 67;
    стала Велика_буква_Д = 68;
    стала Велика_буква_Е = 69;
    стала Велика_буква_Є = 70;
    стала Велика_буква_Ж = 71;
    стала Велика_буква_З = 72;
    стала Велика_буква_И = 73;
    стала Велика_буква_І = 74;
    стала Велика_буква_Ї = 75;
    стала Велика_буква_Й = 76;
    стала Велика_буква_К = 77;
    стала Велика_буква_Л = 78;
    стала Велика_буква_М = 79;
    стала Велика_буква_Н = 80;
    стала Велика_буква_О = 81;
    стала Велика_буква_П = 82;
    стала Велика_буква_Р = 83;
    стала Велика_буква_С = 84;
    стала Велика_буква_Т = 85;
    стала Велика_буква_У = 86;
    стала Велика_буква_Ф = 87;
    стала Велика_буква_Х = 88;
    стала Велика_буква_Ц = 89;
    стала Велика_буква_Ч = 90;
    стала Велика_буква_Ш = 91;
    стала Велика_буква_Щ = 92;
    стала Велика_буква_Ь = 93;
    стала Велика_буква_Ю = 94;
    стала Велика_буква_Я = 95;
    стала Мала_буква_а = 96;
    стала Мала_буква_б = 97;
    стала Мала_буква_в = 98;
    стала Мала_буква_г = 99;
    стала Мала_буква_д = 100;
    стала Мала_буква_е = 101;
    стала Мала_буква_є = 102;
    стала Мала_буква_ж = 103;
    стала Мала_буква_з = 104;
    стала Мала_буква_и = 105;
    стала Мала_буква_і = 106;
    стала Мала_буква_ї = 107;
    стала Мала_буква_й = 108;
    стала Мала_буква_к = 109;
    стала Мала_буква_л = 110;
    стала Мала_буква_м = 111;
    стала Мала_буква_н = 112;
    стала Мала_буква_о = 113;
    стала Мала_буква_п = 114;
    стала Мала_буква_р = 115;
    стала Мала_буква_с = 116;
    стала Мала_буква_т = 117;
    стала Мала_буква_у = 118;
    стала Мала_буква_ф = 119;
    стала Мала_буква_х = 120;
    стала Мала_буква_ц = 121;
    стала Мала_буква_ч = 122;
    стала Мала_буква_ш = 123;
    стала Мала_буква_щ = 124;
    стала Мала_буква_ь = 125;
    стала Мала_буква_ю = 126;
    стала Мала_буква_я = 127;
  }

  секція відповідні_символи_юнікоду {
    стала Кінець = 0;
    стала Дія = 1;
    стала Початок = 2;
    стала Міжряд = 10;
    стала Міжслово = 32;
    стала Хвиляста = 126;
    стала І = 38;
    стала Відсоток = 37;
    стала Секція = 167;
    стала Мітка = 35;
    стала Адреса = 64;
    стала Хрестик_в_кругу = 8853;
    стала Хрестик = 43;
    стала Гривня = 8372;
    стала Нескінченність = 8734;
    стала Зірочка = 42;
    стала Нуль = 48;
    стала Один = 49;
    стала Два = 50;
    стала Три = 51;
    стала Чотири = 52;
    стала Пʼять = 53;
    стала Шість = 54;
    стала Сім = 55;
    стала Вісім = 56;
    стала Девʼять = 57;
    стала Відкрита_фігурна_дужка = 123;
    стала Закрита_фігурна_дужка = 125;
    стала Відкрита_квадратна_дужка = 91;
    стала Закрита_квадратна_дужка = 93;
    стала Відкрита_дужка = 40;
    стала Закрита_дужка = 41;
    стала Менше = 60;
    стала Більше = 62;
    стала Вище = 8743;
    стала Нижче = 8744;
    стала Твердий = 700;
    стала Лапка = 39;
    стала Дволапка = 34;
    стала Косолапка = 96;
    стала Міжкрапка = 183;
    стала Двокрапка = 58;
    стала Кома = 44;
    стала Крапкакома = 59;
    стала Питання = 63;
    стала Оклик = 33;
    стала Крапка = 46;
    стала Похила = 47;
    стала Обернена_похила = 92;
    стала Стояча = 124;
    стала Риска = 45;
    стала Гачок = 172;
    стала Підриска = 95;
    стала Двориска = 61;
    стала Велика_буква_Ё = 1025;
    стала Велика_буква_Ъ = 1066;
    стала Велика_буква_Ы = 1067;
    стала Велика_буква_Э = 1069;
    стала Мала_буква_ё = 1105;
    стала Мала_буква_ъ = 1098;
    стала Мала_буква_ы = 1099;
    стала Мала_буква_э = 1101;
    стала Велика_буква_Ґ = 1168;
    стала Мала_буква_ґ = 1169;
    стала Велика_буква_А = 1040;
    стала Велика_буква_Б = 1041;
    стала Велика_буква_В = 1042;
    стала Велика_буква_Г = 1043;
    стала Велика_буква_Д = 1044;
    стала Велика_буква_Е = 1045;
    стала Велика_буква_Є = 1028;
    стала Велика_буква_Ж = 1046;
    стала Велика_буква_З = 1047;
    стала Велика_буква_И = 1048;
    стала Велика_буква_І = 1030;
    стала Велика_буква_Ї = 1031;
    стала Велика_буква_Й = 1049;
    стала Велика_буква_К = 1050;
    стала Велика_буква_Л = 1051;
    стала Велика_буква_М = 1052;
    стала Велика_буква_Н = 1053;
    стала Велика_буква_О = 1054;
    стала Велика_буква_П = 1055;
    стала Велика_буква_Р = 1056;
    стала Велика_буква_С = 1057;
    стала Велика_буква_Т = 1058;
    стала Велика_буква_У = 1059;
    стала Велика_буква_Ф = 1060;
    стала Велика_буква_Х = 1061;
    стала Велика_буква_Ц = 1062;
    стала Велика_буква_Ч = 1063;
    стала Велика_буква_Ш = 1064;
    стала Велика_буква_Щ = 1065;
    стала Велика_буква_Ь = 1068;
    стала Велика_буква_Ю = 1070;
    стала Велика_буква_Я = 1071;
    стала Мала_буква_а = 1072;
    стала Мала_буква_б = 1073;
    стала Мала_буква_в = 1074;
    стала Мала_буква_г = 1075;
    стала Мала_буква_д = 1076;
    стала Мала_буква_е = 1077;
    стала Мала_буква_є = 1108;
    стала Мала_буква_ж = 1078;
    стала Мала_буква_з = 1079;
    стала Мала_буква_и = 1080;
    стала Мала_буква_і = 1110;
    стала Мала_буква_ї = 1111;
    стала Мала_буква_й = 1081;
    стала Мала_буква_к = 1082;
    стала Мала_буква_л = 1083;
    стала Мала_буква_м = 1084;
    стала Мала_буква_н = 1085;
    стала Мала_буква_о = 1086;
    стала Мала_буква_п = 1087;
    стала Мала_буква_р = 1088;
    стала Мала_буква_с = 1089;
    стала Мала_буква_т = 1090;
    стала Мала_буква_у = 1091;
    стала Мала_буква_ф = 1092;
    стала Мала_буква_х = 1093;
    стала Мала_буква_ц = 1094;
    стала Мала_буква_ч = 1095;
    стала Мала_буква_ш = 1096;
    стала Мала_буква_щ = 1097;
    стала Мала_буква_ь = 1100;
    стала Мала_буква_ю = 1102;
    стала Мала_буква_я = 1103;
  }

  структура Місцезнаходження {
    розмір: позитивне;
    дані: памʼять<позитивне>;
    вмісткість: позитивне;
  }

  дія покласти_в_місцезнаходження(система: адреса<Система>, місцезнаходження: адреса<Місцезнаходження>, позиція_місцезнаходження: позитивне) {
    якщо місцезнаходження.розмір == місцезнаходження.вмісткість {
      місцезнаходження.вмісткість += 1;
      місцезнаходження.дані = перевиділити_памʼять<позитивне>(система, місцезнаходження.дані, місцезнаходження.вмісткість);
    }
    місцезнаходження.дані[місцезнаходження.розмір] = позиція_місцезнаходження;
    місцезнаходження.розмір += 1;
  }

  місцева дія дізнатись_розмір_символа_т8(перший_байт: п8) -> п8;
  місцева дія дізнатись_розмір_символа_ю8(перший_байт: п8) -> п8;
  місцева дія отримати_символ_т8_з_ю32(символ_Ю32: п32, вихід_першого_байта: адреса<п8>, вихід_другого_байта: адреса<п8>, вихід_третього_байта: адреса<п8>, вихід_четвертого_байта: адреса<п8>, вихід_розміру: адреса<п8>) -> логічне;
  місцева дія отримати_символ_ю8_з_т32(символ_КД: п32, вихід_першого_байта: адреса<п8>, вихід_другого_байта: адреса<п8>, вихід_третього_байта: адреса<п8>, вихід_четвертого_байта: адреса<п8>, вихід_розміру: адреса<п8>) -> логічне;
  місцева дія порахувати_розмір_ю8сі(значення: памʼять<п8>) -> позитивне;
  місцева дія порахувати_розмір_ю32сі(значення: памʼять<п32>) -> позитивне;
  місцева дія порахувати_розмір_т8сі(значення: памʼять<п8>) -> позитивне;
  місцева дія порахувати_розмір_т32сі(значення: памʼять<п32>) -> позитивне;
  місцева дія перевірити_чи_ю8_рівні(а: ю8, б: ю8) -> логічне;
  місцева дія перевірити_чи_ю32_рівні(а: ю32, б: ю32) -> логічне;
  місцева дія перевірити_чи_т8_рівні(а: т8, б: т8) -> логічне;
  місцева дія перевірити_чи_т32_рівні(а: т32, б: т32) -> логічне;
  місцева дія перекодувати_ю8_в_т8(система: адреса<Система>, вхід: ю8, екранувати_невідомі: логічне, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<т8>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;
  місцева дія перекодувати_ю8_в_ю32(система: адреса<Система>, вхід: ю8, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<ю32>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;
  місцева дія перекодувати_ю32_в_ю8(система: адреса<Система>, вхід: ю32, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<ю8>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;
  місцева дія перекодувати_т8_в_ю8(система: адреса<Система>, вхід: т8, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<ю8>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;
  місцева дія перекодувати_ю8_в_т8_з_місцезнаходженнями(система: адреса<Система>, вхід: ю8, екранувати_невідомі: логічне, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<т8>, вихід_місцезнаходжень: адреса<Місцезнаходження>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;
  місцева дія перекодувати_т8_в_ю8_з_місцезнаходженнями(система: адреса<Система>, вхід: т8, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<ю8>, вихід_місцезнаходжень: адреса<Місцезнаходження>, вихід_позиції_помилки: адреса<позитивне>) -> логічне;

  місцева дія обробити_екранізації_в_т8(система: адреса<Система>, вхід: т8, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<т8>) -> логічне;
  місцева дія обробити_екранізації_в_ю8(система: адреса<Система>, вхід: ю8, з_нульовим_байтом_в_кінці: логічне, вихід: адреса<ю8>) -> логічне;
}