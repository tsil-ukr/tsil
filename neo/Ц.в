взяти визначення розбирач;
взяти визначення лл;
взяти біб друк;

зовнішня дія отримати_з_карти_юнікод_комірка(карта: комірка<карта_юнікод_комірка>, назва: памʼять<п8>): невідома_комірка;
зовнішня дія змінити_в_карті_юнікод_комірка(карта: комірка<карта_юнікод_комірка>, назва: памʼять<п8>, значення: невідома_комірка);
зовнішня дія створити_карту_юнікод(): комірка<карта_юнікод_комірка>;

секція ц {
  структура список<Т> {
    дані: памʼять<Т>;
    довжина: позитивне;
    вмісткість: позитивне;
  }

  дія виділити_список<Т>(): комірка<список<Т>> {
    ціль с = виділити<список<Т>>();
    с.дані = пусто;
    с.довжина = 0;
    с.вмісткість = 0;
    вернути с;
  }

  дія додати_до_списку<Т>(с: комірка<список<Т>>, значення: Т) {
    якщо с.довжина == с.вмісткість {
      якщо с.вмісткість == 0 {
        с.дані = виділити<Т>(1);
      } інакше {
        с.дані = перевиділити<Т>(с.дані, с.вмісткість + 1);
      }
      с.вмісткість = с.вмісткість + 1;
    }
    с.дані[с.довжина] = значення;
    с.довжина = с.довжина + 1;
  }

  дія звільнити_список<Т>(с: комірка<список<Т>>) {
    звільнити(с.дані);
    звільнити(с);
  }
}

секція ц {
  синонім ВидСубʼєктаНативнийТип = 1;
  синонім ВидСубʼєктаДія = 2;

  синонім ВидТипуНативний = 1;

  структура карта_юнікод_комірка;

  структура Компілятор;
  структура Середовище;
  структура Субʼєкт;
  структура Тип;
  структура Параметр;
  структура ОбʼєктНативногоТипу;
  структура ОбʼєктДії;

  структура Компілятор {
    глобальне_середовище: комірка<Середовище>;
    Л: комірка<ЛМодуль>;
    тип_ніщо: комірка<Тип>;
    тип_ц8: комірка<Тип>;
    тип_ц16: комірка<Тип>;
    тип_ц32: комірка<Тип>;
    тип_ц64: комірка<Тип>;
    тип_п8: комірка<Тип>;
    тип_п16: комірка<Тип>;
    тип_п32: комірка<Тип>;
    тип_п64: комірка<Тип>;
  }

  структура Середовище {
    батьківське: комірка<Середовище>;
    субʼєкти: комірка<карта_юнікод_комірка>;
  }

  структура Субʼєкт {
    вид: позитивне;
    дані: комірка<ОбʼєктНативногоТипу> | комірка<ОбʼєктДії>;
  }

  структура Тип {
    вид: позитивне;
    дані: комірка<ОбʼєктНативногоТипу>;
  }

  структура Параметр {
    назва: памʼять<п8>;
    тип: комірка<Тип>;
  }

  структура ОбʼєктНативногоТипу {
    назва: памʼять<п8>;
    л_тип: комірка<ЛТип>;
  }

  структура ОбʼєктДії {
    назва: памʼять<п8>;
    параметри: комірка<список<комірка<Параметр>>>;
    тип_результату: комірка<Тип>;
    л_функція: комірка<ЛФункція>;
  }

  дія створити_середовище(батьківське: комірка<Середовище>): комірка<Середовище> {
    ціль с = виділити<Середовище>();
    с.батьківське = батьківське;
    с.субʼєкти = створити_карту_юнікод();
    вернути с;
  }

  дія отримати_з_середовища(середовище: комірка<Середовище>, назва: памʼять<п8>): комірка<Субʼєкт> {
    змінна останнє_середовище = середовище;
    поки останнє_середовище != пусто {
      ціль субʼєкт = отримати_з_карти_юнікод_комірка(останнє_середовище.субʼєкти, назва) як комірка<Субʼєкт>;
      якщо субʼєкт != пусто {
        вернути субʼєкт;
      }
      останнє_середовище = останнє_середовище.батьківське;
    }
    вернути пусто;
  }

  дія змінити_в_середовищі(середовище: комірка<Середовище>, назва: памʼять<п8>, значення: комірка<Субʼєкт>) {
    змінити_в_карті_юнікод_комірка(середовище.субʼєкти, назва, значення);
  }

  дія створити_компілятор(): комірка<Компілятор> {
    ціль глобальне_середовище = створити_середовище(пусто);

    ціль К = виділити<Компілятор>();
    К.глобальне_середовище = глобальне_середовище;
    К.Л = лл::створити(ю8"тест.ц");

    ціль тип_ніщо = виділити<Тип>();
    тип_ніщо.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_ніщо = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_ніщо.назва = ю8"ніщо";
    обʼєкт_нативного_типу_ніщо.л_тип = лл::отримати_тип_ніщо(К.Л);
    тип_ніщо.дані = обʼєкт_нативного_типу_ніщо;
    К.тип_ніщо = тип_ніщо;
    ціль субʼєкт_типу_ніщо = виділити<Субʼєкт>();
    субʼєкт_типу_ніщо.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_ніщо.дані = обʼєкт_нативного_типу_ніщо;
    змінити_в_середовищі(глобальне_середовище, ю8"ніщо", субʼєкт_типу_ніщо);

    ціль тип_ц8 = виділити<Тип>();
    тип_ц8.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_ц8 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_ц8.назва = ю8"ц8";
    обʼєкт_нативного_типу_ц8.л_тип = лл::отримати_тип_і8(К.Л);
    тип_ц8.дані = обʼєкт_нативного_типу_ц8;
    К.тип_ц8 = тип_ц8;
    ціль субʼєкт_типу_ц8 = виділити<Субʼєкт>();
    субʼєкт_типу_ц8.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_ц8.дані = обʼєкт_нативного_типу_ц8;
    змінити_в_середовищі(глобальне_середовище, ю8"ц8", субʼєкт_типу_ц8);

    ціль тип_ц16 = виділити<Тип>();
    тип_ц16.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_ц16 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_ц16.назва = ю8"ц16";
    обʼєкт_нативного_типу_ц16.л_тип = лл::отримати_тип_і16(К.Л);
    тип_ц16.дані = обʼєкт_нативного_типу_ц16;
    К.тип_ц16 = тип_ц16;
    ціль субʼєкт_типу_ц16 = виділити<Субʼєкт>();
    субʼєкт_типу_ц16.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_ц16.дані = обʼєкт_нативного_типу_ц16;
    змінити_в_середовищі(глобальне_середовище, ю8"ц16", субʼєкт_типу_ц16);

    ціль тип_ц32 = виділити<Тип>();
    тип_ц32.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_ц32 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_ц32.назва = ю8"ц32";
    обʼєкт_нативного_типу_ц32.л_тип = лл::отримати_тип_і32(К.Л);
    тип_ц32.дані = обʼєкт_нативного_типу_ц32;
    К.тип_ц32 = тип_ц32;
    ціль субʼєкт_типу_ц32 = виділити<Субʼєкт>();
    субʼєкт_типу_ц32.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_ц32.дані = обʼєкт_нативного_типу_ц32;
    змінити_в_середовищі(глобальне_середовище, ю8"ц32", субʼєкт_типу_ц32);

    ціль тип_ц64 = виділити<Тип>();
    тип_ц64.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_ц64 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_ц64.назва = ю8"ц64";
    обʼєкт_нативного_типу_ц64.л_тип = лл::отримати_тип_і64(К.Л);
    тип_ц64.дані = обʼєкт_нативного_типу_ц64;
    К.тип_ц64 = тип_ц64;
    ціль субʼєкт_типу_ц64 = виділити<Субʼєкт>();
    субʼєкт_типу_ц64.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_ц64.дані = обʼєкт_нативного_типу_ц64;
    змінити_в_середовищі(глобальне_середовище, ю8"ц64", субʼєкт_типу_ц64);

    ціль тип_п8 = виділити<Тип>();
    тип_п8.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_п8 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_п8.назва = ю8"п8";
    обʼєкт_нативного_типу_п8.л_тип = лл::отримати_тип_і8(К.Л);
    тип_п8.дані = обʼєкт_нативного_типу_п8;
    К.тип_п8 = тип_п8;
    ціль субʼєкт_типу_п8 = виділити<Субʼєкт>();
    субʼєкт_типу_п8.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_п8.дані = обʼєкт_нативного_типу_п8;
    змінити_в_середовищі(глобальне_середовище, ю8"п8", субʼєкт_типу_п8);

    ціль тип_п16 = виділити<Тип>();
    тип_п16.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_п16 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_п16.назва = ю8"п16";
    обʼєкт_нативного_типу_п16.л_тип = лл::отримати_тип_і16(К.Л);
    тип_п16.дані = обʼєкт_нативного_типу_п16;
    К.тип_п16 = тип_п16;
    ціль субʼєкт_типу_п16 = виділити<Субʼєкт>();
    субʼєкт_типу_п16.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_п16.дані = обʼєкт_нативного_типу_п16;
    змінити_в_середовищі(глобальне_середовище, ю8"п16", субʼєкт_типу_п16);

    ціль тип_п32 = виділити<Тип>();
    тип_п32.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_п32 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_п32.назва = ю8"п32";
    обʼєкт_нативного_типу_п32.л_тип = лл::отримати_тип_і32(К.Л);
    тип_п32.дані = обʼєкт_нативного_типу_п32;
    К.тип_п32 = тип_п32;
    ціль субʼєкт_типу_п32 = виділити<Субʼєкт>();
    субʼєкт_типу_п32.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_п32.дані = обʼєкт_нативного_типу_п32;
    змінити_в_середовищі(глобальне_середовище, ю8"п32", субʼєкт_типу_п32);

    ціль тип_п64 = виділити<Тип>();
    тип_п64.вид = ВидТипуНативний;
    ціль обʼєкт_нативного_типу_п64 = виділити<ОбʼєктНативногоТипу>();
    обʼєкт_нативного_типу_п64.назва = ю8"п64";
    обʼєкт_нативного_типу_п64.л_тип = лл::отримати_тип_і64(К.Л);
    тип_п64.дані = обʼєкт_нативного_типу_п64;
    К.тип_п64 = тип_п64;
    ціль субʼєкт_типу_п64 = виділити<Субʼєкт>();
    субʼєкт_типу_п64.вид = ВидСубʼєктаНативнийТип;
    субʼєкт_типу_п64.дані = обʼєкт_нативного_типу_п64;
    змінити_в_середовищі(глобальне_середовище, ю8"п64", субʼєкт_типу_п64);

    вернути К;
  }

  дія отримати_ЛТип(тип: комірка<Тип>): комірка<ЛТип> {
    якщо тип.вид == ВидТипуНативний {
      ціль дані = тип.дані як комірка<ОбʼєктНативногоТипу>;
      вернути дані.л_тип;
    }
    вернути пусто;
  }
}