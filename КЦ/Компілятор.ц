взяти визначення ./КЦ;

секція КЦ {
  дія створити_тип_т8(компілятор: адреса<Компілятор>): адреса<ОбʼєктТипу> {
    змінна параметри = Параметри { 2, виділити_памʼять<Параметр>(компілятор, 2), 2 };

    параметри.дані[0] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_розмір()),
      тип = компілятор.тип_п64,
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };
    параметри.дані[1] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_дані()),
      тип = створити_тип_памʼяті(компілятор, компілятор.тип_п8),
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };

    змінна обʼєкт_типу_структура = виділити_обʼєкт_типу(компілятор);
    обʼєкт_типу_структура.вид = ВидОбʼєктаТипуСтруктура;
    обʼєкт_типу_структура.дані = ДаніОбʼєктаТипуСтруктура {
      назва = отримати_назву(компілятор, константа_Т8_т8()),
      параметри = параметри,
      повна_назва = отримати_назву(компілятор, константа_Т8_т8()),
      готові_аргументи_шаблону = ГотовіАргументиШаблону { 0, пусто },
      обʼєкт_секції = пусто
    };

    змінна пм_параметри = ПМ::Параметри { 0, пусто, 0 };
    змінна п: природне = 0;
    поки п < параметри.розмір {
      ПМ::покласти_параметр(компілятор.пм_модуль, пм_параметри::адреса, ПМ::Параметр { параметри.дані[п].тип.пм_тип });
      п += 1;
    }

    обʼєкт_типу_структура.пм_тип = ПМ::створити_структуру(
      компілятор.пм_модуль,
      отримати_назву(компілятор, константа_Т8_т8()),
      пм_параметри
    );

    вернути обʼєкт_типу_структура;
  }

  дія створити_тип_т32(компілятор: адреса<Компілятор>): адреса<ОбʼєктТипу> {
    змінна параметри = Параметри { 2, виділити_памʼять<Параметр>(компілятор, 2), 2 };

    параметри.дані[0] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_розмір()),
      тип = компілятор.тип_п64,
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };
    параметри.дані[1] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_дані()),
      тип = створити_тип_памʼяті(компілятор, компілятор.тип_п8),
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };

    змінна обʼєкт_типу_структура = виділити_обʼєкт_типу(компілятор);
    обʼєкт_типу_структура.вид = ВидОбʼєктаТипуСтруктура;
    обʼєкт_типу_структура.дані = ДаніОбʼєктаТипуСтруктура {
      назва = отримати_назву(компілятор, константа_Т8_т32()),
      параметри = параметри,
      повна_назва = отримати_назву(компілятор, константа_Т8_т32()),
      готові_аргументи_шаблону = ГотовіАргументиШаблону { 0, пусто },
      обʼєкт_секції = пусто
    };

    змінна пм_параметри = ПМ::Параметри { 0, пусто, 0 };
    змінна п: природне = 0;
    поки п < параметри.розмір {
      ПМ::покласти_параметр(компілятор.пм_модуль, пм_параметри::адреса, ПМ::Параметр { параметри.дані[п].тип.пм_тип });
      п += 1;
    }

    обʼєкт_типу_структура.пм_тип = ПМ::створити_структуру(
      компілятор.пм_модуль,
      отримати_назву(компілятор, константа_Т8_т32()),
      пм_параметри
    );

    вернути обʼєкт_типу_структура;
  }

  дія створити_тип_ю8(компілятор: адреса<Компілятор>): адреса<ОбʼєктТипу> {
    змінна параметри = Параметри { 2, виділити_памʼять<Параметр>(компілятор, 2), 2 };

    параметри.дані[0] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_розмір()),
      тип = компілятор.тип_п64,
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };
    параметри.дані[1] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_дані()),
      тип = створити_тип_памʼяті(компілятор, компілятор.тип_п8),
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };

    змінна обʼєкт_типу_структура = виділити_обʼєкт_типу(компілятор);
    обʼєкт_типу_структура.вид = ВидОбʼєктаТипуСтруктура;
    обʼєкт_типу_структура.дані = ДаніОбʼєктаТипуСтруктура {
      назва = отримати_назву(компілятор, константа_Т8_ю8()),
      параметри = параметри,
      повна_назва = отримати_назву(компілятор, константа_Т8_ю8()),
      готові_аргументи_шаблону = ГотовіАргументиШаблону { 0, пусто },
      обʼєкт_секції = пусто
    };

    змінна пм_параметри = ПМ::Параметри { 0, пусто, 0 };
    змінна п: природне = 0;
    поки п < параметри.розмір {
      ПМ::покласти_параметр(компілятор.пм_модуль, пм_параметри::адреса, ПМ::Параметр { параметри.дані[п].тип.пм_тип });
      п += 1;
    }

    обʼєкт_типу_структура.пм_тип = ПМ::створити_структуру(
      компілятор.пм_модуль,
      отримати_назву(компілятор, константа_Т8_ю8()),
      пм_параметри
    );

    вернути обʼєкт_типу_структура;
  }

  дія створити_тип_ю32(компілятор: адреса<Компілятор>): адреса<ОбʼєктТипу> {
    змінна параметри = Параметри { 2, виділити_памʼять<Параметр>(компілятор, 2), 2 };

    параметри.дані[0] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_розмір()),
      тип = компілятор.тип_п64,
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };
    параметри.дані[1] = Параметр {
      назва = отримати_назву(компілятор, константа_Т8_дані()),
      тип = створити_тип_памʼяті(компілятор, компілятор.тип_п32),
      Місцезнаходження { пусто, 0 },
      Місцезнаходження { пусто, 0 }
    };

    змінна обʼєкт_типу_структура = виділити_обʼєкт_типу(компілятор);
    обʼєкт_типу_структура.вид = ВидОбʼєктаТипуСтруктура;
    обʼєкт_типу_структура.дані = ДаніОбʼєктаТипуСтруктура {
      назва = отримати_назву(компілятор, константа_Т8_ю32()),
      параметри = параметри,
      повна_назва = отримати_назву(компілятор, константа_Т8_ю32()),
      готові_аргументи_шаблону = ГотовіАргументиШаблону { 0, пусто },
      обʼєкт_секції = пусто
    };

    змінна пм_параметри = ПМ::Параметри { 0, пусто, 0 };
    змінна п: природне = 0;
    поки п < параметри.розмір {
      ПМ::покласти_параметр(компілятор.пм_модуль, пм_параметри::адреса, ПМ::Параметр { параметри.дані[п].тип.пм_тип });
      п += 1;
    }

    обʼєкт_типу_структура.пм_тип = ПМ::створити_структуру(
      компілятор.пм_модуль,
      отримати_назву(компілятор, константа_Т8_ю32()),
      пм_параметри
    );

    вернути обʼєкт_типу_структура;
  }

  місцева дія створити_компілятор(виділяч: адреса<біб::Виділяч>, пм_модуль: адреса<ПМ::Модуль>): адреса<Компілятор> {
    змінна компілятор = біб::виділити<Компілятор>(виділяч);

    компілятор.виділяч = виділяч;
    компілятор.пм_модуль = пм_модуль;

    компілятор.кореневий_шлях = Шлях { 0, пусто };
    компілятор.взяті_файли = створити_взяті_файли(компілятор);

    компілятор.пм_сховище_назв = ПМ::створити_сховище_назв();

    компілятор.перше_середовище = пусто;
    компілятор.останнє_середовище = пусто;
    компілятор.перший_обʼєкт_дії = пусто;
    компілятор.останній_обʼєкт_дії = пусто;
    компілятор.перший_обʼєкт_типу = пусто;
    компілятор.останній_обʼєкт_типу = пусто;
    компілятор.перший_обʼєкт_секції = пусто;
    компілятор.останній_обʼєкт_секції = пусто;
    компілятор.перший_обʼєкт_шаблону = пусто;
    компілятор.останній_обʼєкт_шаблону = пусто;
    компілятор.перший_обʼєкт_сирого_значення = пусто;
    компілятор.останній_обʼєкт_сирого_значення = пусто;
    компілятор.перший_розібраний_текст = пусто;
    компілятор.останній_розібраний_текст = пусто;
    компілятор.перший_текст_коду = пусто;
    компілятор.останній_текст_коду = пусто;

    компілятор.глобальне_середовище = створити_середовище(компілятор, пусто);

    компілятор.тип_ніщо = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_ніщо()), ПМ::отримати_тип_ніщо(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ніщо()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ніщо });

    компілятор.тип_адреса = виділити_обʼєкт_типу(компілятор);
    компілятор.тип_адреса.вид = ВидОбʼєктаТипуАдреса;
    компілятор.тип_адреса.пм_тип = ПМ::отримати_тип_адреса(компілятор.пм_модуль);
    компілятор.тип_адреса.дані = ДаніОбʼєктаТипуАдреса {
      тип_даних = компілятор.тип_ніщо
    };
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_адреса()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_адреса });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_невідома_адреса()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_адреса });

    компілятор.тип_памʼять = виділити_обʼєкт_типу(компілятор);
    компілятор.тип_памʼять.вид = ВидОбʼєктаТипуПамʼять;
    компілятор.тип_памʼять.пм_тип = ПМ::отримати_тип_адреса(компілятор.пм_модуль);
    компілятор.тип_памʼять.дані = ДаніОбʼєктаТипуПамʼять {
      тип_даних = компілятор.тип_ніщо
    };
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_памʼять()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_памʼять });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_невідома_памʼять()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_памʼять });

    компілятор.тип_логічне = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_логічне()), ПМ::отримати_тип_логічне(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_логічне()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_логічне });

    компілятор.тип_ц8 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_ц8()), ПМ::отримати_тип_ц8(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ц8()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ц8 });

    компілятор.тип_ц16 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_ц16()), ПМ::отримати_тип_ц16(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ц16()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ц16 });

    компілятор.тип_ц32 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_ц32()), ПМ::отримати_тип_ц32(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ц32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ц32 });

    компілятор.тип_ц64 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_ц64()), ПМ::отримати_тип_ц64(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ц64()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ц64 });

    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ціле()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ц64 });

    компілятор.тип_п8 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_н8()), ПМ::отримати_тип_п8(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_н8()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п8 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_п8()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п8 });

    компілятор.тип_п16 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_н16()), ПМ::отримати_тип_п16(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_н16()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п16 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_п16()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п16 });

    компілятор.тип_п32 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_н32()), ПМ::отримати_тип_п32(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_н32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п32 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_п32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п32 });

    компілятор.тип_п64 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_н64()), ПМ::отримати_тип_п64(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_н64()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п64 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_п64()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п64 });

    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_натуральне()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п64 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_позитивне()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п64 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_природне()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_п64 });

    компілятор.тип_д32 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_р32()), ПМ::отримати_тип_д32(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_р32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_д32 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_д32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_д32 });

    компілятор.тип_д64 = створити_простий_тип(компілятор, отримати_назву(компілятор, константа_Т8_р64()), ПМ::отримати_тип_д64(компілятор.пм_модуль));
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_р64()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_д64 });
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_д64()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_д64 });

    компілятор.обʼєкт_значення_так = ОбʼєктЗначення { компілятор.тип_логічне, ПМ::створити_логічне(компілятор.пм_модуль, так) };
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_так()), Обʼєкт { ВидОбʼєктаЗначення, компілятор.обʼєкт_значення_так });

    компілятор.обʼєкт_значення_ні = ОбʼєктЗначення { компілятор.тип_логічне, ПМ::створити_логічне(компілятор.пм_модуль, ні) };
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ні()), Обʼєкт { ВидОбʼєктаЗначення, компілятор.обʼєкт_значення_ні });

    компілятор.обʼєкт_значення_пусто = ОбʼєктЗначення { компілятор.тип_адреса, ПМ::отримати_значення_пусто(компілятор.пм_модуль) };
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_пусто()), Обʼєкт { ВидОбʼєктаЗначення, компілятор.обʼєкт_значення_пусто });

    компілятор.тип_т8 = створити_тип_т8(компілятор);
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_т8()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_т8 });

    компілятор.тип_т32 = створити_тип_т32(компілятор);
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_т32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_т32 });

    компілятор.тип_ю8 = створити_тип_ю8(компілятор);
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ю8()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ю8 });

    компілятор.тип_ю32 = створити_тип_ю32(компілятор);
    змінити_в_середовищі(компілятор.глобальне_середовище, отримати_назву(компілятор, константа_Т8_ю32()), Обʼєкт { ВидОбʼєктаТип, компілятор.тип_ю32 });

    вернути компілятор;
  }

  місцева дія знищити_компілятор(компілятор: адреса<Компілятор>) {
    знищити_шлях(компілятор, компілятор.кореневий_шлях);

    знищити_взяті_файли(компілятор.взяті_файли);

    змінна поточне_середовище = компілятор.перше_середовище;
    поки поточне_середовище != пусто {
      змінна наступне = поточне_середовище.наступне;
      знищити_середовище(поточне_середовище);
      поточне_середовище = наступне;
    }

    змінна поточний_обʼєкт_дії = компілятор.перший_обʼєкт_дії;
    поки поточний_обʼєкт_дії != пусто {
      змінна наступний = поточний_обʼєкт_дії.наступний;
      знищити_обʼєкт_дії(компілятор, поточний_обʼєкт_дії);
      поточний_обʼєкт_дії = наступний;
    }

    змінна поточний_обʼєкт_секції = компілятор.перший_обʼєкт_секції;
    поки поточний_обʼєкт_секції != пусто {
      змінна наступний = поточний_обʼєкт_секції.наступний;
      знищити_обʼєкт_секції(компілятор, поточний_обʼєкт_секції);
      поточний_обʼєкт_секції = наступний;
    }

    змінна поточний_обʼєкт_типу = компілятор.перший_обʼєкт_типу;
    поки поточний_обʼєкт_типу != пусто {
      змінна наступний = поточний_обʼєкт_типу.наступний;
      знищити_обʼєкт_типу(компілятор, поточний_обʼєкт_типу);
      поточний_обʼєкт_типу = наступний;
    }

    змінна поточний_обʼєкт_шаблону = компілятор.перший_обʼєкт_шаблону;
    поки поточний_обʼєкт_шаблону != пусто {
      змінна наступний = поточний_обʼєкт_шаблону.наступний;
      знищити_обʼєкт_шаблону(компілятор, поточний_обʼєкт_шаблону);
      поточний_обʼєкт_шаблону = наступний;
    }

    змінна поточний_обʼєкт_сирого_значення = компілятор.перший_обʼєкт_сирого_значення;
    поки поточний_обʼєкт_сирого_значення != пусто {
      змінна наступний = поточний_обʼєкт_сирого_значення.наступний;
      знищити_обʼєкт_сирого_значення(компілятор, поточний_обʼєкт_сирого_значення);
      поточний_обʼєкт_сирого_значення = наступний;
    }

    змінна поточний_розібраний_текст = компілятор.перший_розібраний_текст;
    поки поточний_розібраний_текст != пусто {
      змінна наступний = поточний_розібраний_текст.наступний;
      знищити_розібраний_текст(поточний_розібраний_текст);
      поточний_розібраний_текст = наступний;
    }

    змінна поточний_текст_коду = компілятор.перший_текст_коду;
    поки поточний_текст_коду != пусто {
      змінна наступний = поточний_текст_коду.наступний;
      знищити_текст_коду(поточний_текст_коду);
      поточний_текст_коду = наступний;
    }

    ПМ::знищити_сховище_назв(компілятор.пм_сховище_назв);

    // потім: знищити всі реєстри, накопичувачі, обʼєкти і тд
    біб::звільнити(компілятор.виділяч, компілятор);
  }
}